{% load i18n static %}

{% block extra_js %}
    <script src="{% static 'js/sortable.min.js'%}"></script>
{% endblock %}

<h4>
    {{ structure.title }} : {{ order_type }}
</h4>
<div class="w3-small">{{ structure.breadcrumb }}</div>

<!-- show each sentence-->
{% with structure.get_common_reference as common_reference %}
    {% if common_reference %}
        <div class="w3-small">{{ common_reference.wordlist_version }} : {{ common_reference.from_position }} - {{ common_reference.to_position }}</div>
        <div id="word-list" class="w3-section" style="margin-bottom:1200px !important;">
            <!-- loop words -->
            {% regroup words_list by sentence as sentence_list %}
            {% for sentence_group in sentence_list %}
                <div
                    class="sentence {% if order_type == 'translation' %} sortable {% endif %}"
                    data-post-url="{% url 'htmx_update_translation_sequence_by_sortablejs' %}"
                >
                    {% for word in sentence_group.list %}
                        <!-- Your code to display each word goes here -->
                        <button
                            id="{{ word.id }}"
                            data-sortable-id="{{ word.id }}" 
                            class="pada-btn w3-btn w3-round-xlarge w3-small w3-tooltip"
                            style="border:none; background:none; cursor:pointer;"
                            onclick="handlePadaButtonClick(this); $('#htmx-translation-form').show();"
                            hx-get="{% url "htmx_translation_pada" word.id %}"
                            hx-target="#htmx-translation-form"
                        >
                            <b>{{ word.word }}</b>  {{ word.translation }}
                            <span
                                style="position:absolute;right:0;bottom:18px"
                                class="w3-text w3-tag w3-tiny w3-round-xlarge w3-brown">
                                {{ word.sentence }}.{{ word.word_position }}
                            </span>
                        </button>
                    {% endfor %}
                </div>
            {% endfor %}
            <!-- end loop word -->
        </div>
    {% endif %}
{% endwith %}


{% block script %}
    <script>
        $(document).ready(function() {
            var wordListHeight = $('#word-list').height();

            handleSortable();
        });

        function sendSortedData(url, sortedIDs) {
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': "{{ csrf_token }}"
                },
                body: JSON.stringify({ sortedIDs: sortedIDs })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status !== 'success') {
                    console.error('Error updating order:', data);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
{% endblock %}